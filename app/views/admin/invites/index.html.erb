<div class="page-header">
  <h1 class="page-title">Parent Invites</h1>
  <%= link_to "Create Invite", new_admin_invite_path, class: "btn-primary" %>
</div>

<div class="space-y-6">
  <% if @active_invites.any? %>
    <div class="card">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Active Invites</h2>
      <div class="space-y-3">
        <% @active_invites.each do |invite| %>
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="font-semibold text-gray-800">
                  <% if invite.email.present? %>
                    <%= invite.email %>
                  <% else %>
                    Open Invite
                  <% end %>
                </span>
              </div>
              <div class="text-sm text-gray-600 space-y-1">
                <p>Invited by <%= invite.invited_by.name %> on <%= invite.created_at.strftime("%b %d, %Y") %></p>
                <p>Expires <%= invite.expires_at.strftime("%b %d, %Y at %I:%M %p") %></p>
                <div class="flex items-center gap-2 mt-2">
                  <input type="text"
                         value="<%= invite_url(invite.token) %>"
                         readonly
                         id="invite-<%= invite.id %>"
                         class="flex-1 px-3 py-2 bg-white border border-gray-300 rounded-lg font-mono text-xs"
                  >
                  <button onclick="copyInviteLink('<%= invite.id %>')"
                          class="btn-secondary btn-sm whitespace-nowrap"
                          id="copy-btn-<%= invite.id %>">
                    Copy Link
                  </button>
                </div>
              </div>
            </div>
            <div class="ml-4">
              <%= button_to "Cancel", admin_invite_path(invite), method: :delete, class: "btn-outline btn-sm text-red-600 border-red-600 hover:bg-red-50", data: { turbo_confirm: "Are you sure you want to cancel this invite?" } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @expired_invites.any? %>
    <div class="card">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Expired Invites</h2>
      <div class="space-y-3">
        <% @expired_invites.each do |invite| %>
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl opacity-60">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="font-semibold text-gray-800">
                  <% if invite.email.present? %>
                    <%= invite.email %>
                  <% else %>
                    Open Invite
                  <% end %>
                </span>
                <span class="text-xs bg-gray-300 text-gray-700 px-2 py-1 rounded">Expired</span>
              </div>
              <div class="text-sm text-gray-600">
                <p>Invited by <%= invite.invited_by.name %> on <%= invite.created_at.strftime("%b %d, %Y") %></p>
                <p>Expired <%= invite.expires_at.strftime("%b %d, %Y at %I:%M %p") %></p>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @active_invites.empty? && @expired_invites.empty? %>
    <div class="card">
      <div class="empty-state">
        <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
        </svg>
        <h3 class="empty-state-title">No invites yet</h3>
        <p class="empty-state-text mb-4">Create an invite to add another parent to your family.</p>
        <%= link_to "Create First Invite", new_admin_invite_path, class: "btn-primary" %>
      </div>
    </div>
  <% end %>
</div>

<script>
function copyInviteLink(inviteId) {
  const input = document.getElementById('invite-' + inviteId);
  const btn = document.getElementById('copy-btn-' + inviteId);

  input.select();
  input.setSelectionRange(0, 99999);

  navigator.clipboard.writeText(input.value).then(() => {
    const originalText = btn.textContent;
    btn.textContent = 'Copied!';
    btn.classList.add('bg-green-600', 'text-white', 'border-green-600');

    setTimeout(() => {
      btn.textContent = originalText;
      btn.classList.remove('bg-green-600', 'text-white', 'border-green-600');
    }, 2000);
  }).catch(err => {
    alert('Failed to copy link');
  });
}
</script>
