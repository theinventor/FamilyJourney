<div class="max-w-2xl mx-auto">
  <div class="page-header">
    <h1 class="page-title">Complete Challenge</h1>
    <%= link_to "Back to Badge", badge_path(@badge), class: "btn-outline" %>
  </div>

  <div class="card mb-6">
    <div class="flex items-start gap-4">
      <div class="flex-shrink-0 w-10 h-10 rounded-full gradient-teal flex items-center justify-center text-white font-bold">
        <%= @challenge.position %>
      </div>
      <div>
        <h2 class="text-lg font-bold text-gray-800"><%= @challenge.title %></h2>
        <% if @challenge.description.present? %>
          <p class="text-gray-600 mt-1"><%= @challenge.description %></p>
        <% end %>
        <p class="text-sm text-gray-500 mt-2">Part of: <strong><%= @badge.title %></strong></p>
      </div>
    </div>
  </div>

  <div class="card">
    <%= form_with model: @completion, url: challenge_completions_path(badge_challenge_id: @challenge.id), class: "space-y-6" do |f| %>
      <% if @completion.errors.any? %>
        <div class="p-4 rounded-xl bg-red-50 text-red-800 border border-red-200">
          <h3 class="font-semibold mb-2">Please fix the following errors:</h3>
          <ul class="list-disc list-inside text-sm">
            <% @completion.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= f.label :kid_notes, "Notes (Optional)", class: "form-label" %>
        <%= f.text_area :kid_notes, rows: 3, class: "form-textarea",
            placeholder: "Any notes about how you completed this challenge..." %>
      </div>

      <div>
        <%= f.label :attachments, "Upload Proof (Optional)", class: "form-label" %>
        <%= f.file_field :attachments, multiple: true, class: "block w-full text-sm text-gray-500
          file:mr-4 file:py-2 file:px-4
          file:rounded-xl file:border-0
          file:text-sm file:font-semibold
          file:bg-purple-50 file:text-purple-700
          hover:file:bg-purple-100" %>
        <p class="text-sm text-gray-500 mt-1">Photos or files showing you completed this challenge.</p>
      </div>

      <div class="flex gap-3 pt-4 border-t">
        <%= f.submit "Mark as Complete", class: "btn-success" %>
        <%= link_to "Cancel", badge_path(@badge), class: "btn-secondary" %>
      </div>
    <% end %>
  </div>
</div>
